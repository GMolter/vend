<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Vending Machine</title>
  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    /* RESET & GLOBALS */
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html,body {
      width:100%; height:100vh; overflow:hidden;
      overscroll-behavior:none; touch-action:none;
      font-family:Arial,sans-serif; background:#fff;
    }
    /* show cursor on desktops */
    @media (hover: hover) and (pointer: fine) {
      html,body,button,a { cursor:auto!important; }
    }
    button { transition:transform .1s; user-select:none; }
    button:active { transform:scale(.95); }

    /* APP & VERSION */
    #app { position:relative; width:100%; height:100%; }
    #version-label {
      position:fixed; bottom:10px; left:10px;
      color:#555; font-size:.9em; z-index:9999;
    }
    #devButton {
      position:fixed; top:10px; right:140px;
      width:50px; height:50px; background:transparent;
      border:none; opacity:0; z-index:10002;
      pointer-events:auto;
    }
    /* SCREENS */
    .screen {
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%);
      width:90%; max-width:800px;
      text-align:center; display:none;
    }
    .screen.active { display:block; }

    /* LOGO */
    #logo-screen img {
      width:300px; height:300px; border-radius:50%;
      box-shadow:0 0 20px rgba(0,0,0,.5);
      animation:pulse 2s infinite alternate; cursor:pointer;
    }
    @keyframes pulse { from{transform:scale(1)} to{transform:scale(1.05)} }
    #logo-screen h2 {
      margin-top:20px; font-size:2.5em; color:#333; cursor:pointer;
    }

    /* KEYPAD */
    #keypad-screen h2 { margin-bottom:20px; font-size:2.2em; color:#333; }
    #digit-display { display:flex; justify-content:center; margin-bottom:20px; }
    .digit-box {
      width:70px; height:70px; margin:0 5px;
      border-bottom:2px solid #333;
      font-size:3em; line-height:70px;
    }
    .keypad-grid {
      display:grid; grid-template-columns:repeat(3,1fr);
      gap:10px; justify-items:center;
    }
    .keypad-btn {
      width:100px; height:100px; border-radius:50%;
      background:rgba(0,0,0,.1); color:#333;
      font-size:2.5em; display:flex;
      align-items:center; justify-content:center;
      touch-action:manipulation;
    }
    .keypad-btn.backspace { background:red; color:#fff; }
    .shake { animation:shake .5s; }
    @keyframes shake {
      0%{transform:translateX(0)}20%{transform:translateX(-10px)}
      40%{transform:translateX(10px)}60%{transform:translateX(-10px)}
      80%{transform:translateX(10px)}100%{transform:translateX(0)}
    }

    /* SNACK SCREEN */
    #snack-screen {
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%);
      width:90%; max-width:800px;
      padding-top:100px; text-align:center;
    }
    #student-name {
      position:absolute; top:10px; left:20px;
      font-size:2em; color:#333;
    }
    #menuBtn, #snack-signout {
      position:absolute; top:10px; padding:12px 20px;
      border:none; border-radius:6px; font-size:1em;
      color:#fff; cursor:pointer;
      touch-action:manipulation;
    }
    #menuBtn {
      right:160px; background:#34495e; z-index:10001;
    }
    #snack-signout {
      right:20px; background:#e74c3c;
    }
    #snack-screen h2 {
      font-size:2.5em; margin-bottom:30px; color:#333;
    }
    #snack-grid {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
      gap:15px; margin-bottom:120px; justify-items:center;
    }
    .snack-item {
      background:rgba(0,0,0,.05);
      border:2px solid transparent; padding:15px; border-radius:8px;
      cursor:pointer; transition:background .3s,border-color .3s;
      text-align:center; user-select:none; touch-action:manipulation;
    }
    .snack-item.disabled {
      opacity:.4; pointer-events:none;
    }
    .snack-item.selected {
      background:rgba(52,152,219,.4);
      border-color:#3498db;
    }
    .snack-item h4 { margin-bottom:5px; font-size:1.6em; }
    .snack-item p  { font-size:1.2em; }
    #dispense-button {
      position:absolute; bottom:20px; left:50%;
      transform:translateX(-50%);
      padding:25px 35px; font-size:1.8em;
      background:#2ecc71; border:none; border-radius:8px;
      color:#fff; cursor:pointer; display:none; touch-action:manipulation;
    }

    /* DISPENSE SCREEN */
    #dispense-screen {
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%);
      width:90%; max-width:600px;
      background:#2e3192; border-radius:15px;
      padding:40px; box-shadow:0 10px 30px rgba(0,0,0,.3);
      color:#fff; text-align:center;
    }
    #dispense-screen img { width:100px; height:100px; margin-bottom:20px; }
    #dispense-screen h2 { font-size:2.8em; margin-bottom:10px; }
    #dispense-screen #dispense-text { font-size:1.2em; margin-bottom:10px; }
    #dispense-screen p { font-size:1.4em; margin-bottom:20px; }
    #stay-signed-btn {
      background:#2980b9; border:none; padding:12px 24px;
      font-size:1.2em; color:#fff; border-radius:8px; cursor:pointer;
      touch-action:manipulation;
    }

    /* MODALS */
    .modal-backdrop {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,.3); z-index:10000;
    }
    .modal {
      position:fixed; top:50%; left:50%;
      transform:translate(-50%,-50%);
      background:#fff; border-radius:8px; padding:20px;
      box-shadow:0 5px 20px rgba(0,0,0,.2);
      max-height:80vh; overflow:auto; z-index:10001;
    }
    .modal h3 { margin-bottom:15px; font-size:1.5em; color:#333; }
    .modal .grid {
      display:grid; grid-template-columns:repeat(2,1fr);
      gap:15px;
    }
    .modal .card {
      background:rgba(0,0,0,.05); border-radius:6px;
      padding:10px; text-align:center; cursor:pointer;
      touch-action:manipulation;
    }
    .modal .card.disabled { opacity:.4; pointer-events:none; }
    .modal .btn { 
      display:inline-block; padding:8px 16px; margin:8px 4px;
      border:none; border-radius:4px; font-size:1em;
      color:#fff; cursor:pointer; touch-action:manipulation;
    }
    .modal .btn-primary { background:#3498db; }
    .modal .btn-danger  { background:#e74c3c; }
    .modal .btn-close   { background:#95a5a6; }

    /* STOCK & EDIT modals adjustments */
    #stockModal { width:80%; max-width:500px; left:40%; }
    #editModal  { width:250px; left:75%; }
    @media (max-width:600px) {
      #stockModal { width:90%; left:50%; transform:translate(-50%,-50%); }
      #editModal  { display:none; }
    }

    /* TOAST */
    #toast-container {
      position:fixed; bottom:20px; left:50%;
      transform:translateX(-50%); z-index:10002;
    }
    .toast {
      background:rgba(0,0,0,.8); color:#fff;
      padding:10px 20px; border-radius:4px;
      opacity:0; animation:fadein .3s forwards, fadeout .3s 2.7s forwards;
      margin-top:5px;
    }
    @keyframes fadein { to{opacity:1} }
    @keyframes fadeout{ to{opacity:0} }

    /* iPad full-screen hide address bar */
    body::-webkit-scrollbar { display:none; }
  </style>
</head>
<body>
  <div id="app">
    <button id="devButton"></button>

    <!-- LOGO -->
    <div id="logo-screen" class="screen active">
      <img src="fchs-logo.png" alt="Logo"/>
      <h2>Tap to Begin</h2>
    </div>

    <!-- KEYPAD -->
    <div id="keypad-screen" class="screen">
      <h2>Enter Student ID</h2>
      <div id="digit-display"></div>
      <div id="keypad-buttons" class="keypad-grid"></div>
    </div>

    <!-- SNACKS -->
    <div id="snack-screen" class="screen">
      <div id="student-name">Student Name</div>
      <button id="menuBtn">Menu</button>
      <button id="snack-signout">Sign Out</button>
      <h2>Select a Snack</h2>
      <div id="snack-grid"></div>
      <button id="dispense-button">Dispense Snack</button>
    </div>

    <!-- DISPENSE -->
    <div id="dispense-screen" class="screen">
      <img src="fchs-logo.png" alt="Logo"/>
      <h2 id="thank-you-msg">Thank you!</h2>
      <div id="dispense-text">Your snack(s) will be dispensed shortly</div>
      <p>Signing you out in <span id="countdown">5</span></p>
      <button id="stay-signed-btn">Stay Signed In</button>
    </div>

    <!-- STOCK MANAGEMENT MODAL -->
    <div id="stockBackdrop" class="modal-backdrop" style="display:none;"></div>
    <div id="stockModal" class="modal" style="display:none;">
      <h3>Stock Management</h3>
      <div id="stockGrid" class="grid"></div>
      <button id="stockClose" class="btn btn-close">Close</button>
    </div>

    <!-- EDIT ITEM MODAL -->
    <div id="editModal" class="modal" style="display:none;">
      <h3 id="editTitle">Edit</h3>
      <label>Name:<input id="editName" type="text"/></label><br/>
      <label>Qty:<input id="editQty" type="number"/></label><br/>
      <label><input id="editEnabled" type="checkbox"/> Enabled</label><br/>
      <button id="editCancel" class="btn btn-close">Cancel</button>
      <button id="editSave"   class="btn btn-primary">Save</button>
    </div>

    <div id="toast-container"></div>
    <div id="version-label"></div>
  </div>

  <script>
    // APP VERSION
    const APP_VERSION = "v2.8.0";

    // Firebase init
    const cfg = {
      apiKey: "AIzaSyB3rahMcbUqRAetLoEKwwTDKf89I2sn85Y",
      authDomain: "cyberflashvend.firebaseapp.com",
      databaseURL: "https://cyberflashvend-default-rtdb.firebaseio.com",
      projectId: "cyberflashvend",
      storageBucket: "cyberflashvend.firebasestorage.app",
      messagingSenderId: "63786658773",
      appId: "1:63786658773:web:7792d3693ef45e9ec4eb5c"
    };
    firebase.initializeApp(cfg);
    const db = firebase.database();

    // GLOBALS
    let serverSecret=null,
        machineConfig={},
        currentScreen="logo",
        studentId="",
        snacks=[],
        idleTimer, countdownTimer, countdownValue=5,
        editingItem=null;

    const STUDENTS = {
      "260514":"Gavin Molter","250257":"Amit Ghumaan","251022":"Sun Bawi",
      "250202":"Mitchell Douglass","250298":"Heyden Halstead","270391":"Nate Jones",
      "280335":"Calli Justice","260913":"Levi Kane","280508":"Colden Oakley",
      "250606":"Madeline Penney","250639":"Rohan Rajanahalli","260627":"Mason Robbins"
    };

    // default slots
    const DEFAULT_SLOTS = [
      { id:"A1", name:"Chips",      quantity:8,  enabled:true },
      { id:"A2", name:"Cookies",    quantity:5,  enabled:true },
      { id:"A3", name:"Pretzels",   quantity:12, enabled:true },
      { id:"B1", name:"Candy Bar",  quantity:7,  enabled:true },
      { id:"B2", name:"Granola Bar",quantity:3,  enabled:true },
      { id:"B3", name:"Trail Mix",  quantity:9,  enabled:true }
    ];

    // INITIAL LOAD
    (async function bootstrap(){
      // read server secret
      serverSecret = (await db.ref("Config").once("value")).val();
      // load machineManagement
      const snap = await db.ref("machineManagement").once("value");
      machineConfig = snap.val()||{};
      // merge config into slots
      snacks = DEFAULT_SLOTS.map(slot => {
        const cfg = machineConfig[slot.id];
        return cfg ? { ...slot, ...cfg } : slot;
      });
      initApp();
      // realtime updates
      db.ref("machineManagement").on("value", snap=>{
        machineConfig = snap.val()||{};
        // update array & UI
        snacks.forEach((s,i)=>{
          const cfg = machineConfig[s.id];
          if(cfg){
            s.name=cfg.name; s.quantity=cfg.quantity; s.enabled=cfg.enabled;
          }
          // update snack card if visible
          const card = document.querySelector(`#snack-grid .snack-item[data-id="${s.id}"]`);
          if(card){
            card.querySelector("h4").textContent=s.name;
            card.querySelector("p").textContent=`ID: ${s.id} | Qty: ${s.quantity}`;
            card.classList.toggle("disabled", !s.enabled);
          }
        });
      });
    })();

    // IDLE LOGOUT
    function resetIdle(){
      clearTimeout(idleTimer);
      idleTimer = setTimeout(signOut, 90*1000);
    }
    ["keydown","click","mousemove","touchstart"].forEach(e=>document.addEventListener(e,resetIdle));
    resetIdle();

    // INIT APP
    function initApp(){
      document.getElementById("version-label").textContent=APP_VERSION;
      setupLogo();
      setupKeypad();
      setupSnack();
      setupDispense();
      setupMenu();
      setupStockModals();
      setupToasts();
    }

    // SCREEN SWITCH
    function showScreen(id){
      document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      currentScreen = id.split("-")[0];
      // devButton only on logo
      const btn = document.getElementById("devButton");
      if(currentScreen!=="logo" || studentId) {
        btn.disabled=true; btn.style.pointerEvents="none";
      } else {
        btn.disabled=false; btn.style.pointerEvents="auto";
      }
    }

    // TOASTS
    function setupToasts(){
      window.showToast = msg=>{
        const t=document.createElement("div");
        t.className="toast"; t.textContent=msg;
        document.getElementById("toast-container").appendChild(t);
        setTimeout(()=>t.remove(),3000);
      };
    }

    // LOGO SCREEN
    function setupLogo(){
      const img = document.querySelector("#logo-screen img");
      const txt = document.querySelector("#logo-screen h2");
      ["click","touchstart"].forEach(evt=>{
        img.addEventListener(evt,e=>{
          if(evt==="touchstart")e.preventDefault();
          showScreen("keypad-screen"); initKeypad();
        },{passive:false});
        txt.addEventListener(evt,e=>{
          if(evt==="touchstart")e.preventDefault();
          showScreen("keypad-screen"); initKeypad();
        },{passive:false});
      });
      window.addEventListener("keydown",e=>{
        if(currentScreen==="logo" && e.key==="Enter"){
          showScreen("keypad-screen"); initKeypad();
        }
      });
    }

    // KEYPAD SCREEN
    function setupKeypad(){
      const layout=["1","2","3","4","5","6","7","8","9","","0","backspace"];
      const grid = document.getElementById("keypad-buttons");
      const display = document.getElementById("digit-display");
      let pin="";
      function render(){
        display.innerHTML="";
        for(let i=0;i<6;i++){
          const d=document.createElement("div");
          d.className="digit-box"; d.textContent=i<pin.length?"•":"_";
          display.appendChild(d);
        }
      }
      function handleDigit(ch){
        if(pin.length<6){ pin+=ch; render(); if(pin.length===6) validate(); }
      }
      function handleBack(){
        if(pin.length){ pin=pin.slice(0,-1); render(); }
      }
      function validate(){
        if(STUDENTS[pin]){
          studentId=pin;
          document.getElementById("student-name").textContent=STUDENTS[pin];
          showScreen("snack-screen"); initSnack();
        } else {
          display.classList.add("shake");
          setTimeout(()=>{display.classList.remove("shake");pin="";render();},500);
          showToast("Invalid ID");
        }
      }
      // build buttons once
      if(!grid.children.length){
        layout.forEach(val=>{
          if(!val){
            const ph=document.createElement("div");
            ph.style.width="100px";ph.style.height="100px";
            grid.appendChild(ph);
          } else {
            const btn=document.createElement("div");
            btn.className="keypad-btn";
            if(val==="backspace"){
              btn.textContent="←"; btn.classList.add("backspace");
              btn.addEventListener("click",handleBack);
              btn.addEventListener("touchstart",e=>{e.preventDefault();handleBack();},{passive:false});
            } else {
              btn.textContent=val;
              btn.addEventListener("click",()=>handleDigit(val));
              btn.addEventListener("touchstart",e=>{e.preventDefault();handleDigit(val);},{passive:false});
            }
            grid.appendChild(btn);
          }
        });
      }
      render();
      // keyboard
      window.addEventListener("keydown",e=>{
        if(currentScreen==="keypad" && !e.repeat){
          if(/\d/.test(e.key)) { handleDigit(e.key); }
          else if(e.key==="Backspace") handleBack();
          else if(e.key==="Enter" && pin.length===6) validate();
        }
      });
    }

    // SNACK SCREEN
    function setupSnack(){
      const grid=document.getElementById("snack-grid");
      const dispBtn=document.getElementById("dispense-button");
      const signOutBtn=document.getElementById("snack-signout");
      dispBtn.style.display="none";
      signOutBtn.addEventListener("click",signOut);
      signOutBtn.addEventListener("touchstart",e=>{e.preventDefault();signOut();},{passive:false});

      function renderSnacks(){
        grid.innerHTML="";
        snacks.forEach(s=>{
          const card=document.createElement("div");
          card.className="snack-item"+(s.enabled?"":" disabled");
          card.dataset.id=s.id;
          card.innerHTML=`<h4>${s.name}</h4><p>ID: ${s.id} | Qty: ${s.quantity}</p>`;
          card.addEventListener("click",()=>toggleSelect(s.id));
          card.addEventListener("touchstart",e=>{e.preventDefault();toggleSelect(s.id);},{passive:false});
          grid.appendChild(card);
        });
      }
      const selected=new Set();
      function toggleSelect(id){
        const idx=snacks.findIndex(x=>x.id===id);
        const card=grid.querySelector(`.snack-item[data-id="${id}"]`);
        if(selected.has(id)){
          selected.delete(id); card.classList.remove("selected");
        } else {
          selected.add(id); card.classList.add("selected");
        }
        if(selected.size){
          dispBtn.style.display="block";
          dispBtn.textContent=selected.size>1?"Dispense Snacks":"Dispense Snack";
        } else dispBtn.style.display="none";
      }
      function proceed(){
        if(!selected.size) return;
        sendDispenseSignal([...selected]);
        showScreen("dispense-screen");
      }
      dispBtn.addEventListener("click",proceed);
      dispBtn.addEventListener("touchstart",e=>{e.preventDefault();proceed();},{passive:false});

      renderSnacks();
    }

    // MENU BUTTON & DEV MODE
    function setupMenu(){
      const devBtn=document.getElementById("devButton");
      const menuBtn=document.getElementById("menuBtn");
      // dev toggle
      devBtn.addEventListener("click",activateDev);
      devBtn.addEventListener("touchstart",e=>{e.preventDefault();activateDev();},{passive:false});
      function activateDev(){
        studentId="DEV"; document.getElementById("student-name").textContent="DEV MODE";
        showScreen("snack-screen"); initSnack();
      }
      // only show for DEV
      const observer=new MutationObserver(()=>{
        menuBtn.style.display=(studentId==="DEV")?"block":"none";
      });
      observer.observe(document.getElementById("snack-screen"),{attributes:true});
      // open stock modal
      menuBtn.addEventListener("click",e=>{ e.preventDefault(); openStock(); });
      menuBtn.addEventListener("touchstart",e=>{e.preventDefault();openStock();},{passive:false});
    }

    // STOCK & EDIT MODALS
    function setupStockModals(){
      const stockBackdrop=document.getElementById("stockBackdrop");
      const stockModal=document.getElementById("stockModal");
      const stockGrid=document.getElementById("stockGrid");
      const stockClose=document.getElementById("stockClose");
      const editModal=document.getElementById("editModal");
      const editTitle=document.getElementById("editTitle");
      const editName=document.getElementById("editName");
      const editQty=document.getElementById("editQty");
      const editEnabled=document.getElementById("editEnabled");
      const editSave=document.getElementById("editSave");
      const editCancel=document.getElementById("editCancel");
      function openStock(){
        // build grid
        stockGrid.innerHTML="";
        snacks.forEach(s=>{
          const c=document.createElement("div");
          c.className="card"+(s.enabled?"":" disabled");
          c.innerHTML=`<strong>${s.id}</strong><br/>${s.name}<br/>Qty: ${s.quantity}`;
          c.addEventListener("click",()=>openEdit(s.id));
          stockGrid.appendChild(c);
        });
        stockBackdrop.style.display="block";
        stockModal.style.display="block";
      }
      function closeAll(){
        stockModal.style.display="none";
        stockBackdrop.style.display="none";
        editModal.style.display="none";
      }
      stockClose.addEventListener("click",closeAll);
      stockClose.addEventListener("touchstart",e=>{e.preventDefault();closeAll();},{passive:false});
      stockBackdrop.addEventListener("click",closeAll);

      function openEdit(id){
        editingItem=snacks.find(s=>s.id===id);
        editTitle.textContent="Edit "+id;
        editName.value=editingItem.name;
        editQty.value=editingItem.quantity;
        editEnabled.checked=editingItem.enabled;
        editModal.style.display="block";
      }
      function saveEdit(){
        if(!editingItem) return;
        const key=editingItem.id;
        const val={
          name: editName.value,
          quantity: parseInt(editQty.value,10),
          enabled: editEnabled.checked
        };
        db.ref("machineManagement/"+key).set(val);
        showToast("Saved "+key);
        closeAll();
      }
      editSave.addEventListener("click",saveEdit);
      editSave.addEventListener("touchstart",e=>{e.preventDefault();saveEdit();},{passive:false});
      editCancel.addEventListener("click",closeAll);
      editCancel.addEventListener("touchstart",e=>{e.preventDefault();closeAll();},{passive:false});
    }

    // DISPENSE FLOW
    function setupDispense(){
      const stayBtn=document.getElementById("stay-signed-btn");
      stayBtn.addEventListener("click",()=>{
        clearInterval(countdownTimer);
        showScreen("snack-screen");
      });
      stayBtn.addEventListener("touchstart",e=>{e.preventDefault();
        clearInterval(countdownTimer);showScreen("snack-screen");
      },{passive:false});
      window.addEventListener("keydown",e=>{
        if(currentScreen==="dispense"){
          if(e.key==="Enter"){
            clearInterval(countdownTimer);
            showScreen("snack-screen");
          } else if(e.key==="Escape"){
            clearInterval(countdownTimer);
            signOut();
          }
        }
      });
    }
    function initDispense(){
      const user = STUDENTS[studentId]||studentId||"User";
      document.getElementById("thank-you-msg").textContent=`Thank you, ${user}!`;
      countdownValue=5;
      document.getElementById("countdown").textContent=5;
      countdownTimer=setInterval(()=>{
        countdownValue--;
        document.getElementById("countdown").textContent=countdownValue;
        if(countdownValue<=0){
          clearInterval(countdownTimer);
          signOut();
        }
      },1000);
    }

    // SIGN OUT
    function signOut(){
      clearInterval(countdownTimer);
      studentId="";
      showScreen("logo-screen");
    }

    // SEND SIGNAL
    async function sendDispenseSignal(selectedIds){
      const localKey=localStorage.getItem("secretKey");
      if(localKey!==serverSecret){
        showToast("Unauthorized");
        return;
      }
      const user=STUDENTS[studentId]||studentId;
      const data={ Status:true, User:user };
      snacks.forEach((s,i)=>data[`Item${i+1}`]=selectedIds.includes(s.id));
      await db.ref("data").update(data);
      // clear flags
      setTimeout(()=>db.ref("data").update({ Status:false, Item1:false,Item2:false,Item3:false,Item4:false,Item5:false,Item6:false }),3000);

      // log
      const now=new Date(), mm=("0"+(now.getMonth()+1)).slice(-2),
            dd=("0"+now.getDate()).slice(-2), yy=(""+now.getFullYear()).slice(-2),
            key=`${mm}-${dd}-${yy}`,
            h=now.getHours(), m=("0"+now.getMinutes()).slice(-2),
            s=("0"+now.getSeconds()).slice(-2), ap=h>=12?"pm":"am",
            hr=h%12||12,
            time=`${hr}h:${m}m:${s}s${ap}`,
            payload=selectedIds.join(", ");
      await db.ref(`Logs/${key}`).push({ Time:time, User:user, Payload:payload });
    }
  </script>
</body>
</html>
